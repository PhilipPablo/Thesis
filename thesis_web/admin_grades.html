<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Admin Grades Monitoring | ADV-Attendify</title>

<!-- SweetAlert2 CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:"Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
}

/* ================= BACKGROUND ================= */
body{
    min-height:100vh;
    overflow-x:hidden;
    background:url("images/backgroundhome.png") center/cover no-repeat fixed;
}

/* ================= NAVBAR ================= */
nav{
    position:fixed;
    top:0;
    width:100%;
    padding:20px 40px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    background:rgba(0,0,0,0.25);
    backdrop-filter:blur(8px);
    z-index:1001;
}

.menu-btn{
    font-size:28px;
    background:none;
    border:none;
    color:#6fe3ff;
    cursor:pointer;
}

/* ================= PROFILE ICON ================= */
.profile-wrapper{
    position:relative;
}

.profile{
    width:42px;
    height:42px;
    border-radius:50%;
    overflow:hidden;
    cursor:pointer;
    border:2px solid #6fe3ff;
}

.profile img{
    width:100%;
    height:100%;
    object-fit:cover;
}

/* ================= PROFILE DROPDOWN ================= */
.profile-menu{
    position:absolute;
    top:55px;
    right:0;
    background:#0b2a3a;
    border-radius:12px;
    padding:10px 0;
    min-width:170px;
    opacity:0;
    pointer-events:none;
    transition:0.25s;
    z-index:1002;
}

.profile-menu.active{
    opacity:1;
    pointer-events:all;
}

.profile-menu a{
    display:block;
    padding:12px 20px;
    color:#dffaff;
    text-decoration:none;
    cursor:pointer;
}

.profile-menu a:hover{
    background:#1ea7d7;
    color:#00141c;
}

/* ================= HERO SECTION ================= */
.hero{
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:flex-start;
    padding:120px 40px 40px;
}

/* ================= MAIN PANEL ================= */
.main-panel{
    width:100%;
    max-width:1400px;
    padding:35px;
    background:rgba(255,255,255,0.15);
    backdrop-filter:blur(14px);
    border-radius:26px;
    box-shadow:0 20px 60px rgba(0,0,0,0.4);
}

/* ================= HEADER ================= */
.header-section{
    text-align:center;
    margin-bottom:30px;
    color:#fff;
}

.header-section h1{
    font-size:2.5rem;
    color:#6fe3ff;
    margin-bottom:10px;
    text-shadow:0 2px 5px rgba(0,0,0,0.3);
}

.header-section p{
    font-size:1.1rem;
    color:#070808;
}

/* ================= FILTER SECTION ================= */
.filter-section{
    background:rgba(11,42,58,0.8);
    border-radius:18px;
    padding:20px;
    margin-bottom:30px;
    border:1px solid rgba(110,243,255,0.3);
}

.filter-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));
    gap:20px;
    align-items:end;
}

.filter-item{
    display:flex;
    flex-direction:column;
    gap:8px;
}

.filter-item label{
    color:#6fe3ff;
    font-weight:500;
    font-size:0.95rem;
}

.filter-item select, 
.filter-item input{
    background:rgba(0,20,28,0.6);
    border:1px solid #2c5a6e;
    border-radius:12px;
    padding:12px 15px;
    color:#dffaff;
    font-size:0.95rem;
    outline:none;
    transition:0.2s;
}

.filter-item select:hover,
.filter-item input:hover{
    border-color:#6fe3ff;
}

.filter-item select:focus,
.filter-item input:focus{
    border-color:#6fe3ff;
    box-shadow:0 0 0 2px rgba(110,243,255,0.2);
}

.filter-item option{
    background:#0b2a3a;
    color:#dffaff;
}

.search-btn{
    background:linear-gradient(135deg, #00f2ff, #7f5cff);
    border:none;
    border-radius:12px;
    padding:12px 25px;
    color:#020617;
    font-weight:600;
    cursor:pointer;
    transition:0.2s;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:8px;
}

.search-btn:hover{
    transform:translateY(-2px);
    box-shadow:0 5px 15px rgba(0,242,255,0.3);
}

.reset-btn{
    background:rgba(255,255,255,0.1);
    border:2px solid #6fe3ff;
    border-radius:12px;
    padding:12px 25px;
    color:#dffaff;
    font-weight:600;
    cursor:pointer;
    transition:0.2s;
    width:100%;
}

.reset-btn:hover{
    background:rgba(110,243,255,0.2);
}

/* ================= GRADES TABLE ================= */
.table-container{
    overflow-x:auto;
    border-radius:16px;
    background:rgba(0,20,28,0.6);
    padding:5px;
}

.grades-table{
    width:100%;
    border-collapse:collapse;
    background:rgba(223,250,255,0.1);
    border-radius:16px;
    overflow:hidden;
    min-width:1200px;
}

.grades-table th{
    background:#0b2a3a;
    color:#6fe3ff;
    font-weight:600;
    padding:15px 12px;
    text-align:left;
    border-bottom:3px solid #6fe3ff;
    font-size:0.95rem;
}

.grades-table td{
    padding:15px 12px;
    color:#dffaff;
    border-bottom:1px solid rgba(110,243,255,0.2);
    font-size:0.95rem;
}

.grades-table tbody tr:hover{
    background:rgba(110,243,255,0.1);
    transition:0.2s;
}

/* Professor badge */
.professor-badge{
    display:inline-flex;
    align-items:center;
    gap:8px;
    background:rgba(110,243,255,0.15);
    border-radius:30px;
    padding:5px 15px 5px 5px;
}

.professor-avatar{
    width:30px;
    height:30px;
    border-radius:50%;
    background:linear-gradient(135deg, #00f2ff, #7f5cff);
    display:flex;
    align-items:center;
    justify-content:center;
    color:#020617;
    font-weight:600;
    font-size:0.9rem;
}

/* Subject badge */
.subject-badge{
    background:rgba(30,167,215,0.3);
    border-radius:20px;
    padding:5px 15px;
    display:inline-block;
    font-weight:500;
}

/* Grade badges */
.grade-badge{
    display:inline-block;
    padding:5px 15px;
    border-radius:20px;
    font-weight:600;
    min-width:60px;
    text-align:center;
}

.grade-pass{
    background:rgba(76,175,80,0.2);
    color:#81c784;
    border:1px solid #4caf50;
}

.grade-fail{
    background:rgba(244,67,54,0.2);
    color:#ff8a80;
    border:1px solid #f44336;
}

.grade-pending{
    background:rgba(255,193,7,0.2);
    color:#ffd740;
    border:1px solid #ffc107;
}

/* Empty state */
.empty-state{
    text-align:center;
    padding:60px 20px;
    color:#9bbaca;
}

.empty-state i{
    font-size:4rem;
    margin-bottom:20px;
    display:block;
    opacity:0.5;
}

/* Custom SweetAlert2 styling */
.swal2-popup {
    background: #0b2a3a !important;
    border-radius: 22px !important;
    border: 1px solid rgba(110, 243, 255, 0.25) !important;
}

.swal2-title {
    color: #6ef3ff !important;
}

.swal2-html-container {
    color: #dffaff !important;
}

.swal2-confirm {
    background: linear-gradient(135deg, #00f2ff, #7f5cff) !important;
    color: #020617 !important;
    font-weight: 600 !important;
    border-radius: 12px !important;
}

.swal2-cancel {
    background: rgba(255, 255, 255, 0.15) !important;
    color: #dffaff !important;
    border: 2px solid #6ef3ff !important;
    border-radius: 12px !important;
}

#sidebarContainer {
    position: relative;
    z-index: 1002;
}

/* ================= RESPONSIVE ================= */
@media (max-width:768px){
    .hero{
        padding:100px 20px 20px;
    }
    
    .main-panel{
        padding:20px;
    }
    
    .header-section h1{
        font-size:1.8rem;
    }
    
    .filter-grid{
        grid-template-columns:1fr;
    }
}
</style>
</head>

<body>

<!-- ===== LOAD SIDEBAR HERE ===== -->
<div id="sidebarContainer"></div>

<!-- Navbar -->
<nav>
    <button class="menu-btn" onclick="toggleMenu()">â˜°</button>

    <div class="profile-wrapper">
        <div class="profile" onclick="toggleProfileMenu()">
            <img src="images/profile.png" id="navProfileImage">
        </div>

        <div id="profileMenu" class="profile-menu">
            <a href="admin_profile.html">Edit Profile</a>
            <a onclick="confirmLogout()">Logout</a>
        </div>
    </div>
</nav>

<!-- Main Content -->
<section class="hero">
    <div class="main-panel">
        
        <!-- Header -->
        <div class="header-section">
            <h1>Grade Monitoring Dashboard</h1>
            <p>Real-time view of all professor grade entries</p>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <div class="filter-grid">
                <div class="filter-item">
                    <label>Filter by Professor</label>
                    <select id="professorFilter" onchange="applyFilters()">
                        <option value="all">All Professors</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label>Filter by Subject</label>
                    <select id="subjectFilter" onchange="applyFilters()">
                        <option value="all">All Subjects</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label>Filter by Year Level</label>
                    <select id="yearFilter" onchange="applyFilters()">
                        <option value="all">All Years</option>
                        <option value="1">1st Year</option>
                        <option value="2">2nd Year</option>
                        <option value="3">3rd Year</option>
                        <option value="4">4th Year</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label>Filter by Grade Status</label>
                    <select id="gradeFilter" onchange="applyFilters()">
                        <option value="all">All Grades</option>
                        <option value="passed">Passed (â‰¥75)</option>
                        <option value="failed">Failed (<75)</option>
                        <option value="pending">Not Yet Graded</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label>Search Student</label>
                    <input type="text" id="studentSearch" placeholder="Enter student name..." onkeyup="applyFilters()">
                </div>
                <div class="filter-item">
                    <button class="reset-btn" onclick="resetFilters()">Reset Filters</button>
                </div>
            </div>
        </div>

        <!-- Grades Table -->
        <div class="table-container">
            <table class="grades-table">
                <thead>
                    <tr>
                        <th>Professor</th>
                        <th>Subject</th>
                        <th>Code</th>
                        <th>Student Name</th>
                        <th>Year & Section</th>
                        <th>Grade</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="gradesTableBody">
                    <!-- Data will be populated by JavaScript -->
                </tbody>
            </table>
        </div>

    </div>
</section>

<!-- SweetAlert2 JS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    /* ===== load sidebar component ===== */
    fetch("admin_sidebar.html")
    .then(r => r.text())
    .then(html => {
        document.getElementById("sidebarContainer").innerHTML = html;
        // Initialize sidebar after it's loaded
        initializeSidebar();
    });

    function initializeSidebar() {
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");
    
    if (sidebar && overlay) {
        window.toggleMenu = function(){
            sidebar.classList.toggle("active");
            overlay.classList.toggle("active");
        };
        
        overlay.onclick = toggleMenu;
    }
}

// Logout confirmation function
function confirmLogout() {
    Swal.fire({
        title: 'Are you sure?',
        text: "You will be logged out of your account!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#00f2ff',
        cancelButtonColor: '#ff6b6b',
        confirmButtonText: 'Yes, logout',
        cancelButtonText: 'Cancel',
        background: '#0b2a3a',
        color: '#dffaff'
    }).then((result) => {
        if (result.isConfirmed) {
            // Clear all user data from localStorage
            localStorage.clear();
            
            Swal.fire({
                title: 'Logged Out!',
                text: 'You have been successfully logged out.',
                icon: 'success',
                confirmButtonColor: '#00f2ff',
                background: '#0b2a3a',
                color: '#dffaff'
            }).then(() => {
                // Redirect to login page
                window.location.href = 'login.html';
            });
        }
    });
}

// Load profile data from localStorage
document.addEventListener('DOMContentLoaded', function() {
    // Load profile images
    const savedImage = localStorage.getItem('profileImage');
    if (savedImage) {
        document.getElementById('navProfileImage').src = savedImage;
    }
    
    // Initialize the dashboard
    initializeDashboard();
});

/* profile dropdown */
function toggleProfileMenu(){
    const profileMenu = document.getElementById("profileMenu");
    profileMenu.classList.toggle("active");
}

document.addEventListener("click", function(e){
    const profile = document.querySelector(".profile");
    const menu = document.getElementById("profileMenu");
    if(!profile.contains(e.target) && !menu.contains(e.target)){
        menu.classList.remove("active");
    }
});

// Listen for storage changes to update profile in real-time
window.addEventListener('storage', function(e) {
    if (e.key === 'profileImage') {
        document.getElementById('navProfileImage').src = e.newValue;
    }
});

// ==================== GRADE MONITORING DATA ====================

// Professors database
const professorDB = [
    { id: 'p1', name: 'Dr. Maria Santos', department: 'Computer Engineering', avatar: 'MS' },
    { id: 'p2', name: 'Prof. John Reyes', department: 'Computer Engineering', avatar: 'JR' },
    { id: 'p3', name: 'Engr. Ana Villanueva', department: 'Computer Engineering', avatar: 'AV' },
    { id: 'p4', name: 'Dr. Michael Cruz', department: 'Computer Engineering', avatar: 'MC' },
    { id: 'p5', name: 'Prof. Lisa Garcia', department: 'Computer Engineering', avatar: 'LG' }
];

// Student database (expanded)
const studentDB = [
    { id: 'st1', name: 'Alice Chen', year: '2', section: 'A' },
    { id: 'st2', name: 'Bob Miller', year: '3', section: 'B' },
    { id: 'st3', name: 'Charlie Rose', year: '1', section: 'C' },
    { id: 'st4', name: 'Diana Prince', year: '4', section: 'A' },
    { id: 'st5', name: 'Ethan Hunt', year: '2', section: 'B' },
    { id: 'st6', name: 'Fiona Glen', year: '3', section: 'C' },
    { id: 'st7', name: 'George King', year: '1', section: 'D' },
    { id: 'st8', name: 'Hannah Lee', year: '4', section: 'B' },
    { id: 'st9', name: 'Ian Wright', year: '2', section: 'A' },
    { id: 'st10', name: 'Jane Eyre', year: '3', section: 'D' },
    { id: 'st11', name: 'Kevin Bacon', year: '1', section: 'A' },
    { id: 'st12', name: 'Laura Palmer', year: '2', section: 'C' },
    { id: 'st13', name: 'Mike Ross', year: '3', section: 'A' },
    { id: 'st14', name: 'Nancy Drew', year: '4', section: 'C' },
    { id: 'st15', name: 'Oscar Wilde', year: '1', section: 'B' }
];

// Subjects with assigned professors and students
const subjects = [
    { 
        id: 's1', 
        name: 'Advanced Mathematics', 
        code: 'MATH401', 
        professorId: 'p1',
        students: [
            { id: 'st1', grade: '85' },
            { id: 'st2', grade: '78' },
            { id: 'st6', grade: '92' },
            { id: 'st9', grade: '70' }
        ] 
    },
    { 
        id: 's2', 
        name: 'Data Structures', 
        code: 'CSE202', 
        professorId: 'p2',
        students: [
            { id: 'st3', grade: '88' },
            { id: 'st4', grade: '65' },
            { id: 'st7', grade: '79' },
            { id: 'st10', grade: '95' }
        ] 
    },
    { 
        id: 's3', 
        name: 'Digital Electronics', 
        code: 'ECE310', 
        professorId: 'p3',
        students: [
            { id: 'st5', grade: '82' },
            { id: 'st8', grade: '91' }
        ] 
    },
    { 
        id: 's4', 
        name: 'Algorithms', 
        code: 'CSE301', 
        professorId: 'p4',
        students: [
            { id: 'st1', grade: '77' },
            { id: 'st3', grade: '84' },
            { id: 'st5', grade: '69' },
            { id: 'st7', grade: '88' },
            { id: 'st9', grade: '71' }
        ] 
    },
    { 
        id: 's5', 
        name: 'Operating Systems', 
        code: 'CSE312', 
        professorId: 'p5',
        students: [
            { id: 'st2', grade: '89' },
            { id: 'st4', grade: '73' },
            { id: 'st6', grade: '94' },
            { id: 'st8', grade: '67' }
        ] 
    },
    { 
        id: 's6', 
        name: 'Software Engineering', 
        code: 'CSE321', 
        professorId: 'p1',
        students: [
            { id: 'st11', grade: '86' },
            { id: 'st12', grade: '79' },
            { id: 'st13', grade: '92' },
            { id: 'st14', grade: '81' },
            { id: 'st15', grade: '75' }
        ] 
    },
    { 
        id: 's7', 
        name: 'Computer Networks', 
        code: 'CSE333', 
        professorId: 'p2',
        students: [
            { id: 'st11', grade: '90' },
            { id: 'st12', grade: '68' },
            { id: 'st13', grade: '83' },
            { id: 'st14', grade: '' },
            { id: 'st15', grade: '77' }
        ] 
    },
    { 
        id: 's8', 
        name: 'Database Systems', 
        code: 'CSE344', 
        professorId: 'p3',
        students: [
            { id: 'st1', grade: '93' },
            { id: 'st3', grade: '72' },
            { id: 'st5', grade: '84' },
            { id: 'st7', grade: '' }
        ] 
    }
];

// Current filters
let currentFilters = {
    professor: 'all',
    subject: 'all',
    year: 'all',
    grade: 'all',
    student: ''
};

// Initialize dashboard
function initializeDashboard() {
    populateFilterOptions();
    renderGradesTable();
}

// Populate filter dropdowns
function populateFilterOptions() {
    const professorSelect = document.getElementById('professorFilter');
    const subjectSelect = document.getElementById('subjectFilter');
    
    // Clear existing options except "all"
    professorSelect.innerHTML = '<option value="all">All Professors</option>';
    subjectSelect.innerHTML = '<option value="all">All Subjects</option>';
    
    // Add professors
    professorDB.forEach(prof => {
        const option = document.createElement('option');
        option.value = prof.id;
        option.textContent = prof.name;
        professorSelect.appendChild(option);
    });
    
    // Add subjects
    subjects.forEach(sub => {
        const professor = professorDB.find(p => p.id === sub.professorId);
        const option = document.createElement('option');
        option.value = sub.id;
        option.textContent = `${sub.name} (${professor ? professor.name : 'Unknown'})`;
        subjectSelect.appendChild(option);
    });
}

// Apply filters
window.applyFilters = function() {
    currentFilters = {
        professor: document.getElementById('professorFilter').value,
        subject: document.getElementById('subjectFilter').value,
        year: document.getElementById('yearFilter').value,
        grade: document.getElementById('gradeFilter').value,
        student: document.getElementById('studentSearch').value.toLowerCase()
    };
    
    renderGradesTable();
};

// Reset filters
window.resetFilters = function() {
    document.getElementById('professorFilter').value = 'all';
    document.getElementById('subjectFilter').value = 'all';
    document.getElementById('yearFilter').value = 'all';
    document.getElementById('gradeFilter').value = 'all';
    document.getElementById('studentSearch').value = '';
    
    currentFilters = {
        professor: 'all',
        subject: 'all',
        year: 'all',
        grade: 'all',
        student: ''
    };
    
    renderGradesTable();
};

// Render grades table with filters
function renderGradesTable() {
    const tbody = document.getElementById('gradesTableBody');
    let allGrades = [];
    
    // Collect all grades from all subjects
    subjects.forEach(subject => {
        const professor = professorDB.find(p => p.id === subject.professorId);
        
        subject.students.forEach(enrollment => {
            const student = studentDB.find(s => s.id === enrollment.id);
            if (student) {
                allGrades.push({
                    professorId: subject.professorId,
                    professorName: professor ? professor.name : 'Unknown',
                    professorAvatar: professor ? professor.avatar : 'UN',
                    subjectId: subject.id,
                    subjectName: subject.name,
                    subjectCode: subject.code,
                    studentId: student.id,
                    studentName: student.name,
                    year: student.year,
                    section: student.section,
                    grade: enrollment.grade || ''
                });
            }
        });
    });
    
    // Apply filters
    let filteredGrades = allGrades.filter(item => {
        // Professor filter
        if (currentFilters.professor !== 'all' && item.professorId !== currentFilters.professor) {
            return false;
        }
        
        // Subject filter
        if (currentFilters.subject !== 'all' && item.subjectId !== currentFilters.subject) {
            return false;
        }
        
        // Year filter
        if (currentFilters.year !== 'all' && item.year !== currentFilters.year) {
            return false;
        }
        
        // Grade status filter
        if (currentFilters.grade !== 'all') {
            const gradeNum = parseFloat(item.grade);
            if (currentFilters.grade === 'passed' && (isNaN(gradeNum) || gradeNum < 75)) {
                return false;
            }
            if (currentFilters.grade === 'failed' && (isNaN(gradeNum) || gradeNum >= 75)) {
                return false;
            }
            if (currentFilters.grade === 'pending' && item.grade !== '') {
                return false;
            }
        }
        
        // Student name filter
        if (currentFilters.student && !item.studentName.toLowerCase().includes(currentFilters.student)) {
            return false;
        }
        
        return true;
    });
    
    // Render table
    if (filteredGrades.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="7">
                    <div class="empty-state">
                        <i>ðŸ“Š</i>
                        <h3>No grades found</h3>
                        <p>Try adjusting your filters to see more results</p>
                    </div>
                </td>
            </tr>
        `;
        return;
    }
    
    tbody.innerHTML = '';
    filteredGrades.forEach(item => {
        const row = document.createElement('tr');
        
        // Determine grade status and class
        const gradeNum = parseFloat(item.grade);
        let gradeClass = 'grade-pending';
        let statusText = 'Pending';
        
        if (item.grade && !isNaN(gradeNum)) {
            if (gradeNum >= 75) {
                gradeClass = 'grade-pass';
                statusText = 'Passed';
            } else {
                gradeClass = 'grade-fail';
                statusText = 'Failed';
            }
        }
        
        row.innerHTML = `
            <td>
                <div class="professor-badge">
                    <div class="professor-avatar">${item.professorAvatar}</div>
                    ${item.professorName}
                </div>
            </td>
            <td>
                <span class="subject-badge">${item.subjectName}</span>
            </td>
            <td>${item.subjectCode}</td>
            <td class="student-name">${item.studentName}</td>
            <td>Year ${item.year} Â· Section ${item.section}</td>
            <td>
                <span class="grade-badge ${gradeClass}">
                    ${item.grade || 'â€”'}
                </span>
            </td>
            <td>
                <span class="grade-badge ${gradeClass}">
                    ${statusText}
                </span>
            </td>
        `;
        
        tbody.appendChild(row);
    });
}

// Auto-refresh every 30 seconds to get latest grades
setInterval(() => {
    renderGradesTable();
}, 30000);

</script>

</body>
</html>
