<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Home | ADV-Attendify</title>

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:"Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
}

body{
    min-height:100vh;
    overflow-x:hidden;
    background:url("images/backgroundhome.png") center/cover no-repeat fixed;
}

nav{
    position:fixed;
    top:0;
    width:100%;
    padding:20px 40px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    background:rgba(0,0,0,0.25);
    backdrop-filter:blur(8px);
    z-index:1001;
}

.menu-btn{
    font-size:28px;
    background:none;
    border:none;
    color:#6fe3ff;
    cursor:pointer;
}

.profile{
    width:42px;
    height:42px;
    border-radius:50%;
    overflow:hidden;
    cursor:pointer;
    border:2px solid #6fe3ff;
}

.profile img{
    width:100%;
    height:100%;
    object-fit:cover;
}

.profile-menu{
    position:absolute;
    top:55px;
    right:0;
    background:#0b2a3a;
    border-radius:12px;
    padding:10px 0;
    min-width:170px;
    opacity:0;
    pointer-events:none;
    transition:0.25s;
}

.profile-menu.active{
    opacity:1;
    pointer-events:all;
}

.profile-menu a{
    display:block;
    padding:12px 20px;
    color:#dffaff;
    text-decoration:none;
}

.profile-menu a:hover{
    background:#1ea7d7;
    color:#00141c;
}

/* Main content area */
.main-content {
    margin-left: 280px;
    padding: 100px 40px 40px 40px;
}

.welcome-section {
    background: rgba(11, 42, 58, 0.7);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 30px;
    border: 1px solid rgba(111, 227, 255, 0.3);
}

.welcome-section h1 {
    color: #6fe3ff;
    font-size: 32px;
    margin-bottom: 10px;
}

.welcome-section p {
    color: #dffaff;
    font-size: 16px;
    opacity: 0.9;
}

/* Subjects Grid */
.subjects-section {
    margin-bottom: 40px;
}

.section-title {
    color: #6fe3ff;
    font-size: 24px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 500;
    letter-spacing: 0.5px;
}

.subjects-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 25px;
}

.subject-card {
    background: rgba(11, 42, 58, 0.8);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    padding: 24px;
    border: 1px solid rgba(111, 227, 255, 0.2);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.subject-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: #6fe3ff;
    opacity: 0.5;
}

.subject-card:hover {
    transform: translateY(-5px);
    border-color: rgba(111, 227, 255, 0.6);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
}

.subject-card:hover::before {
    opacity: 1;
}

.subject-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
}

.subject-icon {
    width: 40px;
    height: 40px;
    background: rgba(111, 227, 255, 0.1);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #6fe3ff;
    font-size: 20px;
    font-weight: 600;
}

.subject-name {
    color: #6fe3ff;
    font-size: 20px;
    font-weight: 600;
    letter-spacing: 0.3px;
}

.professor-info {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
    color: #dffaff;
}

.professor-avatar {
    width: 32px;
    height: 32px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #a0e7ff;
    font-size: 14px;
    font-weight: 500;
    text-transform: uppercase;
}

.professor-name {
    color: #dffaff;
    font-size: 15px;
    font-weight: 400;
}

.professor-dept {
    display: block;
    font-size: 12px;
    opacity: 0.7;
    margin-top: 2px;
}

.subject-details {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid rgba(111, 227, 255, 0.2);
}

.schedule {
    color: #a0e7ff;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 6px;
}

.schedule-icon {
    opacity: 0.8;
}

.attendance-badge {
    background: rgba(111, 227, 255, 0.15);
    color: #6fe3ff;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 500;
    border: 1px solid rgba(111, 227, 255, 0.3);
}

.loading {
    text-align: center;
    padding: 40px;
    color: #dffaff;
    font-size: 16px;
    grid-column: 1 / -1;
    letter-spacing: 0.5px;
}

.error-message {
    text-align: center;
    padding: 40px;
    color: #ff8a8a;
    background: rgba(11, 42, 58, 0.8);
    border-radius: 16px;
    grid-column: 1 / -1;
}

.no-subjects {
    text-align: center;
    padding: 60px 40px;
    color: #dffaff;
    background: rgba(11, 42, 58, 0.8);
    border-radius: 16px;
    grid-column: 1 / -1;
}

.no-subjects p {
    font-size: 18px;
    margin-bottom: 12px;
    letter-spacing: 0.3px;
}

.no-subjects-sub {
    opacity: 0.7;
    font-size: 14px !important;
}

/* Responsive Design */
@media (max-width: 768px) {
    .main-content {
        margin-left: 0;
        padding: 100px 20px 40px 20px;
    }
    
    .subjects-grid {
        grid-template-columns: 1fr;
    }
}

</style>
</head>
<body>

<div id="sidebarContainer"></div>

<nav>
    <button class="menu-btn" onclick="toggleMenu()">â˜°</button>

    <div class="profile-wrapper">
        <div class="profile" onclick="toggleProfileMenu()">
            <img src="images/profile.png" id="navProfileImage">
        </div>

        <div id="profileMenu" class="profile-menu">
            <a href="edit_profile.html">Edit Profile</a>
            <a href="#">Settings</a>
            <a href="login.html">Logout</a>
        </div>
    </div>
</nav>

<!-- Main Content Area -->
<div class="main-content">
    <div class="welcome-section">
        <h1>Welcome back, <span id="fullNameDisplay">Student</span>!</h1>
        <p>Here are your enrolled subjects for Semester <span id="semesterDisplay">1</span>, AY <span id="academicYearDisplay">2025-2026</span></p>
    </div>

    <!-- Subjects Section -->
    <div class="subjects-section">
        <div class="section-title">
            My Subjects
        </div>
        
        <div id="subjectsGridContainer" class="subjects-grid">
            <!-- Subjects will be dynamically loaded here -->
            <div class="loading">Loading your subjects...</div>
        </div>
    </div>
</div>

<script>
    // ============================================
    // DATABASE SIMULATION / API SERVICE LAYER
    // ============================================
    
    // Database schema for subjects and professors
    const DatabaseService = {
        // Mock database tables
        _tables: {
            students: [
                { id: 1, fullName: "John Doe", studentId: "2024-001", semester: 1, academicYear: "2025-2026" }
            ],
            
            professors: [
                { id: 1, name: "Prof. Michael Chen", department: "Computer Science", email: "m.chen@univ.edu", initials: "MC" },
                { id: 2, name: "Prof. Sarah Johnson", department: "Information Technology", email: "s.johnson@univ.edu", initials: "SJ" },
                { id: 3, name: "Prof. David Williams", department: "Computer Science", email: "d.williams@univ.edu", initials: "DW" },
                { id: 4, name: "Prof. Emily Rodriguez", department: "Artificial Intelligence", email: "e.rodriguez@univ.edu", initials: "ER" },
                { id: 5, name: "Prof. James Lee", department: "Mobile Computing", email: "j.lee@univ.edu", initials: "JL" },
                { id: 6, name: "Prof. Lisa Thompson", department: "Cybersecurity", email: "l.thompson@univ.edu", initials: "LT" }
            ],
            
            subjects: [
                { id: 101, code: "CS301", name: "Data Structures & Algorithms", professorId: 1, schedule: "Mon, Wed | 10:00 AM", room: "Room 401", icon: "DSA" },
                { id: 102, code: "IT202", name: "Web Development", professorId: 2, schedule: "Tue, Thu | 2:00 PM", room: "Lab 203", icon: "WEB" },
                { id: 103, code: "CS250", name: "Database Systems", professorId: 3, schedule: "Mon, Wed | 1:00 PM", room: "Room 305", icon: "DB" },
                { id: 104, code: "AI401", name: "Artificial Intelligence", professorId: 4, schedule: "Tue, Thu | 11:00 AM", room: "Lab 101", icon: "AI" },
                { id: 105, code: "IT305", name: "Mobile App Development", professorId: 5, schedule: "Fri | 9:00 AM", room: "Lab 204", icon: "MAD" },
                { id: 106, code: "CYB201", name: "Cybersecurity Fundamentals", professorId: 6, schedule: "Wed, Fri | 3:00 PM", room: "Room 210", icon: "SEC" },
                { id: 107, code: "CS350", name: "Operating Systems", professorId: 1, schedule: "Mon, Wed | 3:00 PM", room: "Room 402", icon: "OS" },
                { id: 108, code: "IT315", name: "Cloud Computing", professorId: 2, schedule: "Tue, Thu | 9:00 AM", room: "Lab 205", icon: "CLD" }
            ],
            
            enrollments: [
                { studentId: 1, subjectId: 101, attendance: 85, currentGrade: "A-" },
                { studentId: 1, subjectId: 102, attendance: 92, currentGrade: "A" },
                { studentId: 1, subjectId: 103, attendance: 78, currentGrade: "B+" },
                { studentId: 1, subjectId: 104, attendance: 94, currentGrade: "A" },
                { studentId: 1, subjectId: 105, attendance: 88, currentGrade: "B+" },
                { studentId: 1, subjectId: 106, attendance: 81, currentGrade: "B" }
            ]
        },

        // Current logged in user
        currentUser: { id: 1, type: 'student' },

        // ============================================
        // API METHODS
        // ============================================

        async getStudentInfo(studentId) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    const student = this._tables.students.find(s => s.id === studentId);
                    resolve(student || this._tables.students[0]);
                }, 300);
            });
        },

        async getStudentSubjects(studentId) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    try {
                        const enrollments = this._tables.enrollments.filter(e => e.studentId === studentId);
                        
                        const subjectsWithDetails = enrollments.map(enrollment => {
                            const subject = this._tables.subjects.find(s => s.id === enrollment.subjectId);
                            const professor = this._tables.professors.find(p => p.id === subject.professorId);
                            
                            return {
                                ...subject,
                                attendance: enrollment.attendance,
                                grade: enrollment.currentGrade,
                                professorName: professor.name,
                                professorInitials: professor.initials,
                                professorEmail: professor.email,
                                professorDepartment: professor.department
                            };
                        });

                        resolve(subjectsWithDetails);
                    } catch (error) {
                        reject(error);
                    }
                }, 500);
            });
        },

        async getAllSubjects() {
            return new Promise((resolve) => {
                setTimeout(() => {
                    const subjectsWithProfessors = this._tables.subjects.map(subject => {
                        const professor = this._tables.professors.find(p => p.id === subject.professorId);
                        return {
                            ...subject,
                            professorName: professor.name,
                            professorInitials: professor.initials
                        };
                    });
                    resolve(subjectsWithProfessors);
                }, 300);
            });
        },

        async getSubjectsByProfessor(professorId) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    const subjects = this._tables.subjects.filter(s => s.professorId === professorId);
                    resolve(subjects);
                }, 300);
            });
        },

        async updateAttendance(studentId, subjectId, newAttendance) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    const enrollment = this._tables.enrollments.find(
                        e => e.studentId === studentId && e.subjectId === subjectId
                    );
                    if (enrollment) {
                        enrollment.attendance = newAttendance;
                    }
                    resolve({ success: true, newAttendance });
                }, 400);
            });
        }
    };

    // ============================================
    // UI RENDERING AND DATA FETCHING
    // ============================================

    async function initializeDashboard() {
        try {
            await loadUserProfile();
            await loadStudentSubjects();
        } catch (error) {
            console.error('Error initializing dashboard:', error);
            showError('Failed to load dashboard data. Please refresh the page.');
        }
    }

    async function loadUserProfile() {
        let studentId = localStorage.getItem('studentId');
        let fullName = localStorage.getItem('userFullName');
        
        if (!studentId) {
            studentId = 1;
            localStorage.setItem('studentId', studentId);
        }

        if (!fullName) {
            const studentInfo = await DatabaseService.getStudentInfo(parseInt(studentId));
            fullName = studentInfo.fullName;
            localStorage.setItem('userFullName', fullName);
            
            document.getElementById('semesterDisplay').textContent = studentInfo.semester || '1';
            document.getElementById('academicYearDisplay').textContent = studentInfo.academicYear || '2025-2026';
        }

        document.getElementById('fullNameDisplay').textContent = fullName;
        
        const savedImage = localStorage.getItem('profileImage');
        if (savedImage) {
            document.getElementById('navProfileImage').src = savedImage;
        }
    }

    async function loadStudentSubjects() {
        const container = document.getElementById('subjectsGridContainer');
        
        try {
            container.innerHTML = '<div class="loading">Loading your subjects...</div>';
            
            const studentId = parseInt(localStorage.getItem('studentId') || '1');
            const subjects = await DatabaseService.getStudentSubjects(studentId);
            
            container.innerHTML = '';
            
            if (subjects.length === 0) {
                container.innerHTML = `
                    <div class="no-subjects">
                        <p>You are not enrolled in any subjects yet</p>
                        <p class="no-subjects-sub">Please contact your registrar for subject enrollment</p>
                    </div>
                `;
                return;
            }
            
            subjects.forEach(subject => {
                const subjectCard = createSubjectCard(subject);
                container.appendChild(subjectCard);
            });
            
        } catch (error) {
            console.error('Error loading subjects:', error);
            container.innerHTML = '<div class="error-message">Failed to load subjects. Please try again later.</div>';
        }
    }

    function createSubjectCard(subject) {
        const card = document.createElement('div');
        card.className = 'subject-card';
        card.setAttribute('data-subject-id', subject.id);
        card.setAttribute('data-subject-code', subject.code);
        
        const scheduleText = subject.room ? `${subject.schedule} | ${subject.room}` : subject.schedule;
        
        card.innerHTML = `
            <div class="subject-header">
                <div class="subject-icon">${subject.icon || subject.code.substring(0, 3)}</div>
                <div class="subject-name">${subject.name}</div>
            </div>
            <div class="professor-info">
                <div class="professor-avatar">${subject.professorInitials || 'PR'}</div>
                <div class="professor-name">
                    ${subject.professorName}
                    <span class="professor-dept">${subject.professorDepartment || ''}</span>
                </div>
            </div>
            <div class="subject-details">
                <span class="schedule">
                    <span class="schedule-icon">ðŸ“…</span>
                    ${scheduleText}
                </span>
                <span class="attendance-badge">${subject.attendance}% Attendance</span>
            </div>
        `;
        
        card.addEventListener('click', function(e) {
            if (e.target.tagName === 'A' || e.target.tagName === 'BUTTON') return;
            console.log(`Navigate to subject: ${subject.id} - ${subject.name}`);
        });
        
        return card;
    }

    function showError(message) {
        const container = document.getElementById('subjectsGridContainer');
        if (container) {
            container.innerHTML = `<div class="error-message">${message}</div>`;
        }
    }

    // ============================================
    // SIDEBAR AND PROFILE MENU FUNCTIONS
    // ============================================

    function toggleProfileMenu(){
        const profileMenu = document.getElementById("profileMenu");
        profileMenu.classList.toggle("active");
    }

    document.addEventListener("click", function(e){
        const profile = document.querySelector(".profile");
        const menu = document.getElementById("profileMenu");
        if(!profile.contains(e.target) && !menu.contains(e.target)){
            menu.classList.remove("active");
        }
    });

    window.addEventListener('storage', function(e) {
        if (e.key === 'profileImage') {
            document.getElementById('navProfileImage').src = e.newValue;
        }
        if (e.key === 'userFullName') {
            document.getElementById('fullNameDisplay').textContent = e.newValue;
        }
    });

    // ============================================
    // DATABASE ADMIN FUNCTIONS
    // ============================================

    window.addEnrollment = async function(studentId, subjectId, attendance = 0) {
        DatabaseService._tables.enrollments.push({
            studentId: studentId,
            subjectId: subjectId,
            attendance: attendance,
            currentGrade: 'N/A'
        });
        await loadStudentSubjects();
    };

    window.updateAttendance = async function(studentId, subjectId, newAttendance) {
        await DatabaseService.updateAttendance(studentId, subjectId, newAttendance);
        await loadStudentSubjects();
    };

    // ============================================
    // INITIALIZATION
    // ============================================

    fetch("sidebar.html")
        .then(r => r.text())
        .then(html => {
            document.getElementById("sidebarContainer").innerHTML = html;
            initializeSidebar();
            initializeDashboard();
        })
        .catch(error => {
            console.error('Error loading sidebar:', error);
            initializeDashboard();
        });

    function initializeSidebar() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("overlay");
        
        if (sidebar && overlay) {
            window.toggleMenu = function(){
                sidebar.classList.toggle("active");
                overlay.classList.toggle("active");
            };
            
            overlay.onclick = toggleMenu;
        }
    }

    window.db = DatabaseService;
</script>

<!-- Database Schema Documentation -->
<!-- 
    students: id, fullName, studentId, semester, academicYear
    professors: id, name, department, email, initials
    subjects: id, code, name, professorId, schedule, room, icon
    enrollments: studentId, subjectId, attendance, currentGrade
-->

</body>
</html>